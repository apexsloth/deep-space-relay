{"id":"deep_space_relay-024","title":"Implement dsr_get_history tool","description":"Add a new tool  that allows an agent to retrieve the recent conversation history of its Telegram thread. This should include:\n1. Messages sent by the agent (via DSR).\n2. Messages received from the user (via Telegram).\n3. System events like reactions or compaction summaries if applicable.\n\nThe tool should fetch this from the OpenCode session messages and format it clearly for the agent.","status":"closed","priority":3,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-04T23:32:48.376590604+01:00","created_by":"apexsloth","updated_at":"2026-02-06T14:05:21.6680337+01:00","closed_at":"2026-02-06T14:05:21.6680337+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-08k","title":"Bug: Add locking to prevent duplicate thread creation","description":"Multiple messages can create duplicate threads. Fix: Add promise/lock to ensureThread. Location: server.ts","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T17:58:40.83600763+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:05:59.379191858+01:00","closed_at":"2026-02-06T18:05:59.379191858+01:00","close_reason":"Added promise-based locking to ensureThread"}
{"id":"deep_space_relay-0d9","title":"Fix leader election race conditions and EADDRINUSE handling","description":"If two instances start simultaneously, the one that fails to bind the socket should fall back to standby mode instead of exiting. Also, unlink logic should be more defensive.","status":"closed","priority":1,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T09:43:55.954245113+01:00","created_by":"apexsloth","updated_at":"2026-02-06T11:34:41.499892789+01:00","closed_at":"2026-02-06T11:34:41.499892789+01:00","close_reason":"Verified: LifecycleCoordinator handles race conditions and EADDRINUSE fallback.","dependencies":[{"issue_id":"deep_space_relay-0d9","depends_on_id":"deep_space_relay-y2z","type":"blocks","created_at":"2026-02-06T09:48:15.2283427+01:00","created_by":"apexsloth"}],"comments":[{"id":4,"issue_id":"deep_space_relay-0d9","author":"apexsloth","text":"Solution will be implemented in LifecycleCoordinator (y2z). Only verification is needed when that work is done.","created_at":"2026-02-06T08:48:19Z"}]}
{"id":"deep_space_relay-0fd","title":"Refactor: Remove daemon kill code (SIGTERM/SIGKILL)","description":"We don't want to kill other daemons. Remove force takeover code that sends SIGTERM/SIGKILL to existing leaders. Location: lifecycle.ts:290-309","status":"closed","priority":2,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-06T18:15:08.491165343+01:00","created_by":"apexsloth","updated_at":"2026-02-07T08:37:33.265132944+01:00","closed_at":"2026-02-07T08:37:33.265132944+01:00","close_reason":"Removed force kill code, now uses IPC-only graceful shutdown"}
{"id":"deep_space_relay-0nd","title":"Agent-to-Agent Chat","description":"Phase 2: Enable agents to message each other through their Telegram threads. Daemon-routed P2P messaging where dsr_send_to_agent(@AgentName, msg) delivers messages cross-thread. Messages visible in both agent threads.","status":"open","priority":3,"issue_type":"epic","owner":"code@apexsloth.com","created_at":"2026-02-08T19:22:38.226888879+01:00","created_by":"apexsloth","updated_at":"2026-02-08T19:22:38.226888879+01:00"}
{"id":"deep_space_relay-0ni","title":"BUG: isKnownProjectChat guard silently drops commands from unknown chats","description":"BUG: isKnownProjectChat guard silently drops all commands from chats without active sessions\n\n## Bug Description\nThe isKnownProjectChat check at line 167-174 in src/daemon/commands.ts drops ALL commands from chats without active sessions. This means commands like /cleanup, /list, /help, /agent sent from a chat with no active sessions will vanish silently with only a log entry.\n\n## Impact\nUsers expect /list, /cleanup, /help, /agent to work regardless of whether sessions exist. These are daemon-level commands, not session-specific.\n\n## Expected Behavior\nGlobal commands (/list, /cleanup, /help) should bypass the isKnownProjectChat check and be processed unconditionally. Only session-specific messages should require a known chat.\n\n## Current Code\nsrc/daemon/commands.ts:167-174:\n```typescript\nconst isKnownProjectChat = Array.from(state.sessions.values()).some(\n  (s) =\u003e String(s.chatId) === String(msgChatId)\n);\nif (!isKnownProjectChat) {\n  log(`[Daemon] Ignoring message from unknown chat: ${msgChatId}`, 'info');\n  return;\n}\n```","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-11T18:09:51.176100482+01:00","created_by":"apexsloth","updated_at":"2026-02-11T18:10:53.354034056+01:00","closed_at":"2026-02-11T18:10:53.354034056+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-0sv","title":"Socket message framing with NDJSON","description":"JSON messages over Unix sockets can fragment or merge across TCP packets. Current code uses raw JSON.parse on socket data which fails when messages are split or concatenated. Fix: Implement newline-delimited JSON (NDJSON) with buffer accumulation in both plugin (index.ts:64-85) and daemon (daemon.ts:86-104). Append \\n to all writes, buffer on reads, split by \\n before parsing.","status":"closed","priority":1,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-04T12:37:07.447693165+01:00","created_by":"apexsloth","updated_at":"2026-02-04T12:38:18.037605208+01:00","closed_at":"2026-02-04T12:38:18.037605208+01:00","close_reason":"Implemented NDJSON framing"}
{"id":"deep_space_relay-0tk","title":"Refactor: Standardize error handling patterns","description":"Inconsistent: some return {success:false}, others throw, others silent. Fix: Pick one pattern. Various locations.","status":"closed","priority":2,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-06T18:05:45.267401821+01:00","created_by":"apexsloth","updated_at":"2026-02-07T08:43:28.334042985+01:00","closed_at":"2026-02-07T08:43:28.334042985+01:00","close_reason":"Standardized error handling - fixed 16 silent catch blocks, added proper logging"}
{"id":"deep_space_relay-142","title":"Add bot command /config for auto-configuration","description":"Add /config bot command that helps user set up the relay:\n- Detects chat ID automatically\n- Guides user through token setup\n- Shows current configuration status\n- Provides setup instructions","status":"closed","priority":2,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-04T17:32:54.636636239+01:00","created_by":"apexsloth","updated_at":"2026-02-04T21:28:25.112566508+01:00","closed_at":"2026-02-04T21:28:25.112566508+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-14i","title":"Bug: Config errors should fail loudly not return empty","description":"Corrupt config returns empty {} silently. Fix: Throw error or return error state. Location: config.ts:22-31","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T18:04:32.395394021+01:00","created_by":"apexsloth","updated_at":"2026-02-07T09:00:36.066400436+01:00","closed_at":"2026-02-07T09:00:36.066400436+01:00","close_reason":"Config errors now throw instead of returning empty object"}
{"id":"deep_space_relay-19i","title":"Graceful daemon shutdown","description":"Daemon has no SIGTERM/SIGINT handlers. Socket file not cleaned up on graceful shutdown. Fix: Add process.on('SIGTERM') and process.on('SIGINT') handlers that call bot.stopPolling(), server.close(), and unlinkSync(socketPath).","status":"closed","priority":3,"issue_type":"chore","owner":"code@apexsloth.com","created_at":"2026-02-04T12:37:19.87017946+01:00","created_by":"apexsloth","updated_at":"2026-02-04T21:28:25.081475934+01:00","closed_at":"2026-02-04T21:28:25.081475934+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-1me","title":"deleteIdleMessage race condition","description":"In index.ts:108-113, idleMessageId is cleared AFTER the await, creating a race window where concurrent calls both try to delete the same message. Fix: Clear idleMessageId immediately (const msgId = idleMessageId; idleMessageId = undefined;) then await the delete.","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-04T12:37:12.609507436+01:00","created_by":"apexsloth","updated_at":"2026-02-04T12:46:23.19904836+01:00","closed_at":"2026-02-04T12:46:23.19904836+01:00","close_reason":"Fixed race by clearing idleMessageId before await"}
{"id":"deep_space_relay-2n1","title":"Filter plugin-injected messages from idle summaries","description":"The idle summary currently includes messages from other plugins. It should only include the last assistant/user message directly relevant to the conversation. Update handleSessionStatus in events.ts to filter out messages with specific plugin metadata.","status":"closed","priority":3,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-05T12:30:06.45672514+01:00","created_by":"apexsloth","updated_at":"2026-02-05T12:32:32.000365853+01:00","closed_at":"2026-02-05T12:32:32.000365853+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-2p2","title":"State Reconciler for Telegram Thread Management","description":"Replace the current reactive thread management (ensureThread + recoverStaleThread + sendWithRecovery) with a declarative reconciler pattern. Internal state is the source of truth; a reconcile() function maps it to Telegram (creating/recreating threads, updating titles, pinning dashboards). Main agents get threads eagerly on register; subagents remain lazy (only on first send). Fixes broadcast not working when thread was deleted.","status":"closed","priority":1,"issue_type":"epic","owner":"code@apexsloth.com","created_at":"2026-02-11T21:24:51.401230309+01:00","created_by":"apexsloth","updated_at":"2026-02-11T22:02:00.704550627+01:00","closed_at":"2026-02-11T22:02:00.704550627+01:00","close_reason":"All 6 subtasks complete. Declarative state reconciler replaces ensureThread/recoverStaleThread chain. Main agents get threads eagerly, subagents stay lazy. Broadcast bug fixed. 93/93 tests passing."}
{"id":"deep_space_relay-2p2.1","title":"Define reconciler state model","description":"Define the internal state model that serves as source of truth. Clean up SessionInfo to clearly separate internal state (agentName, project, title, chatId, parentID) from Telegram state (threadID, statusMessageID, verified). Add a 'verified' flag to track whether the Telegram thread is known-good.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","estimated_minutes":60,"created_at":"2026-02-11T21:24:57.004323461+01:00","created_by":"apexsloth","updated_at":"2026-02-11T22:01:47.732025963+01:00","closed_at":"2026-02-11T22:01:47.732025963+01:00","close_reason":"threadVerified flag added to SessionInfo in types.ts","dependencies":[{"issue_id":"deep_space_relay-2p2.1","depends_on_id":"deep_space_relay-2p2","type":"parent-child","created_at":"2026-02-11T21:24:57.005542106+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-2p2.2","title":"Implement reconcile() function","description":"Create a reconcile(sessionID, state, bot, chatId) function that: (1) creates thread if missing and session is main agent, (2) recreates thread if marked unverified/stale, (3) updates thread title if metadata changed, (4) ensures dashboard is pinned. Subagents only reconcile if they already had a threadID. Replace ensureThread + recoverStaleThread with this single function.","status":"closed","priority":1,"issue_type":"task","owner":"code@apexsloth.com","estimated_minutes":120,"created_at":"2026-02-11T21:25:00.256645631+01:00","created_by":"apexsloth","updated_at":"2026-02-11T22:01:49.413703557+01:00","closed_at":"2026-02-11T22:01:49.413703557+01:00","close_reason":"reconciler.ts created with reconcile(), reconcileDashboard(), isThreadError(), clearThreadState(), createThread()","dependencies":[{"issue_id":"deep_space_relay-2p2.2","depends_on_id":"deep_space_relay-2p2","type":"parent-child","created_at":"2026-02-11T21:25:00.257696894+01:00","created_by":"apexsloth"},{"issue_id":"deep_space_relay-2p2.2","depends_on_id":"deep_space_relay-2p2.1","type":"blocks","created_at":"2026-02-11T21:25:13.610849226+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-2p2.3","title":"Integrate reconciler into registration and send flows","description":"Call reconcile() from handleRegister (eager thread for main agents), handleSend (lazy thread for subagents, recovery on thread errors), and optionally on a periodic timer. Simplify sendWithRecovery to just mark thread as unverified and call reconcile() instead of inline recovery. Remove recoverStaleThread.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","estimated_minutes":90,"created_at":"2026-02-11T21:25:02.937006172+01:00","created_by":"apexsloth","updated_at":"2026-02-11T22:01:51.294742189+01:00","closed_at":"2026-02-11T22:01:51.294742189+01:00","close_reason":"All handlers, server, runner, commands, index updated to use reconcile instead of ensureThread. Main agents get threads eagerly on register.","dependencies":[{"issue_id":"deep_space_relay-2p2.3","depends_on_id":"deep_space_relay-2p2","type":"parent-child","created_at":"2026-02-11T21:25:02.938360599+01:00","created_by":"apexsloth"},{"issue_id":"deep_space_relay-2p2.3","depends_on_id":"deep_space_relay-2p2.2","type":"blocks","created_at":"2026-02-11T21:25:13.706265358+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-2p2.4","title":"Fix broadcast routing to not require threadID","description":"Since main agents now always have threads after register+reconcile, the threadID check in broadcast routing (commands.ts:571) becomes redundant. However, keep the !parentID check to exclude subagents. Also ensure /all still reaches all connected clients regardless. This fixes the bug where broadcasts don't work after thread deletion.","status":"closed","priority":1,"issue_type":"task","owner":"code@apexsloth.com","estimated_minutes":30,"created_at":"2026-02-11T21:25:06.37311666+01:00","created_by":"apexsloth","updated_at":"2026-02-11T22:01:52.758774528+01:00","closed_at":"2026-02-11T22:01:52.758774528+01:00","close_reason":"Removed threadID check from broadcast routing in commands.ts. Main agents always have threadID via eager creation.","dependencies":[{"issue_id":"deep_space_relay-2p2.4","depends_on_id":"deep_space_relay-2p2","type":"parent-child","created_at":"2026-02-11T21:25:06.374244295+01:00","created_by":"apexsloth"},{"issue_id":"deep_space_relay-2p2.4","depends_on_id":"deep_space_relay-2p2.3","type":"blocks","created_at":"2026-02-11T21:25:13.804869735+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-2p2.5","title":"Update tests for reconciler behavior","description":"Update integration tests: (1) main agents get thread on register (not lazy), (2) subagents still lazy, (3) broadcast works even after thread deletion (new test), (4) thread title updates on metadata change, (5) dashboard recreated after thread recreation. Remove/update tests that assumed lazy-only thread creation for main agents.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","estimated_minutes":90,"created_at":"2026-02-11T21:25:09.108968731+01:00","created_by":"apexsloth","updated_at":"2026-02-11T22:01:54.287013278+01:00","closed_at":"2026-02-11T22:01:54.287013278+01:00","close_reason":"All 93 integration tests updated and passing. Updated hasThread expectations, thread creation counts, naming tests.","dependencies":[{"issue_id":"deep_space_relay-2p2.5","depends_on_id":"deep_space_relay-2p2","type":"parent-child","created_at":"2026-02-11T21:25:09.109973788+01:00","created_by":"apexsloth"},{"issue_id":"deep_space_relay-2p2.5","depends_on_id":"deep_space_relay-2p2.3","type":"blocks","created_at":"2026-02-11T21:25:13.899627083+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-2p2.6","title":"Improve pinned dashboard message management","description":"The pinned status dashboard message needs better lifecycle management: (1) Recreate dashboard if it was deleted but thread still exists, (2) Update dashboard content when session metadata changes (agent name, status, project), (3) Handle edit failures gracefully (message deleted ‚Üí recreate and re-pin), (4) Store statusMessageID reliably and recover it during reconcile(). Currently syncStatusDashboard silently fails if the message was deleted. The reconciler should detect missing dashboard and recreate+pin it.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","estimated_minutes":60,"created_at":"2026-02-11T21:25:25.869336805+01:00","created_by":"apexsloth","updated_at":"2026-02-11T22:01:55.69948457+01:00","closed_at":"2026-02-11T22:01:55.69948457+01:00","close_reason":"syncStatusDashboard recreates deleted dashboards. reconcileDashboard handles lifecycle in reconciler.","dependencies":[{"issue_id":"deep_space_relay-2p2.6","depends_on_id":"deep_space_relay-2p2","type":"parent-child","created_at":"2026-02-11T21:25:25.870799713+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-2zr","title":"Telegram API Rate Limiting and Backoff","description":"The TelegramClient lacks any rate-limiting, backoff, or queueing mechanisms. High-activity periods or status spam will trigger unhandled 429 errors from Telegram, leading to dropped notifications and unreliable delivery.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-05T22:58:09.915982775+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:18:19.106789374+01:00","closed_at":"2026-02-06T18:18:19.106789374+01:00","close_reason":"Covered by 69t - rate limiting in telegram.ts","labels":["task"],"dependencies":[{"issue_id":"deep_space_relay-2zr","depends_on_id":"deep_space_relay-69t","type":"blocks","created_at":"2026-02-06T09:48:15.701367013+01:00","created_by":"apexsloth"}],"comments":[{"id":9,"issue_id":"deep_space_relay-2zr","author":"apexsloth","text":"Solution will be implemented in Resilient Bot Client (69t). Only verification is needed when that work is done.","created_at":"2026-02-06T08:48:20Z"}]}
{"id":"deep_space_relay-327","title":"relay: Fix null assertion crash in promise resolver lookup","description":"Relay core can crash when timeout fires between checking for and using promise resolvers due to TOCTOU race condition.\n\n**Location:** src/relay/core.ts:129, 154, 170\n\n**Current behavior:**\n- Line 111 checks: if (msg.correlationId \u0026\u0026 pendingResolves.has(msg.correlationId))\n- Line 129 uses: pendingResolves.get(msg.correlationId)!(msg)\n- Non-null assertion operator (!) crashes if resolver doesn't exist\n- Race condition: timeout handler (lines 244-248) can delete resolver between check and use\n- Same pattern in pendingPermissionResolvers (line 154) and pendingAskResolvers (line 170)\n\n**Impact:**\n- Daemon crashes when timeout fires at unlucky moment\n- Affects all IPC operations (register, permission requests, ask prompts)\n- Lost session state on crash\n\n**Reproduction:**\n1. Send IPC request\n2. Have timeout fire exactly between has() check and get() call\n3. Daemon crashes with 'Cannot read property of undefined'\n\n**Fix:**\nReplace pattern:\n\n\nWith defensive pattern:\n\n\n**Severity:** Critical - causes daemon crashes and lost sessions","status":"closed","priority":1,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-07T09:18:30.698402787+01:00","created_by":"apexsloth","updated_at":"2026-02-07T21:07:57.085884653+01:00","closed_at":"2026-02-07T21:07:57.085884653+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-3vw","title":"Bug: Add entropy to correlation ID to prevent collisions","description":"ID uses pid_timestamp_counter - can collide after restart. Fix: Add crypto.randomBytes. Location: core.ts:8-12","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T18:04:52.549338488+01:00","created_by":"apexsloth","updated_at":"2026-02-07T08:59:10.852553235+01:00","closed_at":"2026-02-07T08:59:10.852553235+01:00","close_reason":"Added crypto.randomBytes entropy to correlation ID"}
{"id":"deep_space_relay-3wk","title":"Global Registration Lock prevents concurrent agent registration","description":"A single global 'registering' flag in events.ts causes silent failures when multiple agents start simultaneously.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-05T22:56:53.202372921+01:00","created_by":"apexsloth","updated_at":"2026-02-06T14:20:21.430957918+01:00","closed_at":"2026-02-06T14:20:21.430957918+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-3xl","title":"Journal: Investigation of DOMException and INVALID_NODE_TYPE_ERR during Interrupt","description":"Journal entry documenting the investigation into DOMException errors during user interrupts.\n\n### Summary of Findings\n- **DOMException**: This is the standard exception class thrown by AbortController.abort(). It is NOT related to HTML DOM but to the Web API AbortSignal adopted by Bun/Node.\n- **INVALID_NODE_TYPE_ERR**: A specific error code (24) that appears in Bun when a fetch or stream is aborted in a specific state. It is a symptom of an unhandled abort in the platform layer.\n- **Root Cause**: The plugin initiates async operations (like fetching messages for summaries or compaction) immediately after a session status change to 'idle' (which happens on interrupt). Since the abort signal is still active, these new calls are immediately aborted, throwing the exception.\n- **Behavioral Bug**: We are not passing the AbortSignal (from ctx.abort in tools) to the SDK or Relay, and our event handlers lack top-level protection and proactive abort checks.\n\n### Fix Pattern\n1. Pass AbortSignal to all client.session.* and relay.* calls.\n2. Add proactive checks: if (ctx.abort?.aborted) return;\n3. Wrap event handlers in try-catch to prevent exceptions from bubbling up to the OpenCode UI.\n\n### Debugging Added\nModified handleSessionError in events.ts to log the full error object and stack trace.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-05T17:50:56.183262238+01:00","created_by":"apexsloth","updated_at":"2026-02-06T13:04:46.459294414+01:00","closed_at":"2026-02-06T13:04:46.459294414+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-3xz","title":"Security: Add socket buffer size limit","description":"Socket buffers grow without limit. Fix: Add 10MB limit in server.ts and core.ts, disconnect if exceeded.","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T17:58:36.507822809+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:10:38.22807367+01:00","closed_at":"2026-02-06T18:10:38.22807367+01:00","close_reason":"Added 10MB buffer limit to server.ts and core.ts"}
{"id":"deep_space_relay-4hl","title":"Fix incorrect model label for antigravity-gemini-3-flash","description":"The model antigravity-gemini-3-flash is labeled as 'Sonnet 3.7' in the UI. Correct this to 'Gemini 3 Flash'.","status":"closed","priority":3,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T09:43:56.141926379+01:00","created_by":"apexsloth","updated_at":"2026-02-07T09:06:27.735925131+01:00","closed_at":"2026-02-07T09:06:27.735925131+01:00","close_reason":"Closed per user request"}
{"id":"deep_space_relay-4k3","title":"Implement /agent and /model bot commands","description":"Add /agent and /model commands to the bot menu and implement handlers to show/change agent names and models.","status":"closed","priority":2,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-05T11:53:44.137734788+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:19:58.620238473+01:00","closed_at":"2026-02-06T18:19:58.620238473+01:00","close_reason":"Closed per user request"}
{"id":"deep_space_relay-4lt","title":"Send welcome message to subagents with Discworld naming suggestion","description":"Update the session.created handler to send the welcome message to subagents as well, and update the text to suggest picking a creative name from the Discworld to avoid collisions.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-05T11:53:44.106857525+01:00","created_by":"apexsloth","updated_at":"2026-02-05T18:13:19.592793621+01:00","closed_at":"2026-02-05T18:13:19.592793621+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-4r4","title":"Telegram Command Pass-Through","description":"Enable forwarding Telegram commands (/compact, /new, /model) and !bang shell commands to connected OpenCode agents. Commands typed in a Telegram thread that don't match DSR bot commands get dispatched to the agent session for that thread.","status":"open","priority":2,"issue_type":"epic","owner":"code@apexsloth.com","created_at":"2026-02-08T19:22:08.447601358+01:00","created_by":"apexsloth","updated_at":"2026-02-08T19:22:08.447601358+01:00"}
{"id":"deep_space_relay-4r4.1","title":"Rename DSR /compact to /close","description":"DSR's /compact command (deletes threads) conflicts with OpenCode's /compact (compacts context). Rename DSR's command to /close to avoid ambiguity. Update command handler, help text, and tests.","status":"open","priority":2,"issue_type":"task","owner":"code@apexsloth.com","estimated_minutes":30,"created_at":"2026-02-08T19:22:13.786352975+01:00","created_by":"apexsloth","updated_at":"2026-02-08T19:22:13.786352975+01:00","dependencies":[{"issue_id":"deep_space_relay-4r4.1","depends_on_id":"deep_space_relay-4r4","type":"parent-child","created_at":"2026-02-08T19:22:13.787316236+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-4r4.2","title":"Generic command dispatcher in daemon","description":"When a Telegram message in a thread starts with / or ! and doesn't match a DSR bot command, forward it to the connected agent as a new IPC message type {type:'command', command:string, args:string[]}. Add the new types to types.ts.","status":"open","priority":2,"issue_type":"task","owner":"code@apexsloth.com","estimated_minutes":60,"created_at":"2026-02-08T19:22:25.36162479+01:00","created_by":"apexsloth","updated_at":"2026-02-08T19:22:25.36162479+01:00","dependencies":[{"issue_id":"deep_space_relay-4r4.2","depends_on_id":"deep_space_relay-4r4","type":"parent-child","created_at":"2026-02-08T19:22:25.362716618+01:00","created_by":"apexsloth"},{"issue_id":"deep_space_relay-4r4.2","depends_on_id":"deep_space_relay-4r4.1","type":"blocks","created_at":"2026-02-08T19:22:41.935029248+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-4r4.3","title":"Plugin-side command handlers","description":"Plugin receives {type:'command'} IPC messages and dispatches to handlers. For /compact, /new, /model: inject as prompts via client.session.prompt(). For !bang: execute via child_process, capture output, send back to Telegram and inject into session.","status":"open","priority":2,"issue_type":"task","owner":"code@apexsloth.com","estimated_minutes":60,"created_at":"2026-02-08T19:22:33.090879566+01:00","created_by":"apexsloth","updated_at":"2026-02-08T19:22:33.090879566+01:00","dependencies":[{"issue_id":"deep_space_relay-4r4.3","depends_on_id":"deep_space_relay-4r4","type":"parent-child","created_at":"2026-02-08T19:22:33.091821327+01:00","created_by":"apexsloth"},{"issue_id":"deep_space_relay-4r4.3","depends_on_id":"deep_space_relay-4r4.2","type":"blocks","created_at":"2026-02-08T19:22:42.017208777+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-51c","title":"Security: Require non-empty token for daemon auth","description":"Empty token.json bypasses auth. Fix: Require non-empty token, fail startup otherwise. Location: server.ts:48","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T17:58:42.242498355+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:03:53.733676064+01:00","closed_at":"2026-02-06T18:03:53.733676064+01:00","close_reason":"Added token validation - daemon fails startup if token is empty"}
{"id":"deep_space_relay-57p","title":"plugin: Fix worker path resolution for global installs","description":"Embedded daemon mode fails to start when plugin is globally installed because worker path resolution assumes plugin is in project directory.\n\n**Location:** src/index.ts:75-76\n\n**Current behavior:**\n- Lines 75-76 construct worker path as: join(directory, 'plugins/deep-space-relay/dist/daemon/worker.js')\n- 'directory' is ctx.directory (user's project path)\n- This only works if plugin is installed inside user's project (dev setup)\n- Fails for global plugin installs (e.g., ~/.config/opencode/plugins/)\n\n**Impact:**\n- Breaks embedded daemon auto-start for global installs\n- Users must run standalone daemon manually\n- Reduces convenience of embedded mode\n\n**Workarounds:**\n- Use standalone daemon (bun run src/daemon.ts)\n- Set embedded: false in config\n- Install plugin locally in project\n\n**Fix:**\nUse __dirname or import.meta.url to resolve worker path relative to plugin installation directory, not user's project directory.\n\n**Severity:** Critical for embedded mode, no impact on standalone daemon mode.","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-07T09:18:15.439829556+01:00","created_by":"apexsloth","updated_at":"2026-02-07T10:09:27.721877815+01:00","closed_at":"2026-02-07T10:09:27.721877815+01:00","close_reason":"Worker code removed - now standalone daemon only"}
{"id":"deep_space_relay-65g","title":"Bug: Remove silent error swallowing (empty catch blocks)","description":"Multiple empty catch blocks hide errors. Locations: core.ts:152, handlers.ts:159/398/522, commands.ts:126/155/189. Fix: Log or propagate errors.","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T18:03:35.608436527+01:00","created_by":"apexsloth","updated_at":"2026-02-07T09:04:08.689335281+01:00","closed_at":"2026-02-07T09:04:08.689335281+01:00","close_reason":"Fixed 10 remaining empty catch blocks with logging or comments"}
{"id":"deep_space_relay-69t","title":"Implement Atomic Persistence and Resilient Bot Client","description":"Atomic state saving (write-tmp-rename) and global Telegram API rate-limiting/retry logic.","design":"### Implementation Plan: Atomic Persistence \u0026 Resilient Bot Client\n\nGoal: Ensure state integrity and handle Telegram API limitations gracefully.\n\n#### 1. Resilient Bot Client\n- Wrap `TelegramClient` calls with a retry/backoff mechanism.\n- Implement a global request queue to handle Telegram's 30 msg/sec limit.\n- Catch 429 errors and wait for `retry_after`.\n\n#### 2. Atomic Persistence\n- Apply the same atomic write strategy (tmp -\u003e rename) used in ConfigManager to the `state.json` file.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-06T09:47:59.96264064+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:18:18.93066387+01:00","closed_at":"2026-02-06T18:18:18.93066387+01:00","close_reason":"Resilient bot client with rate limiting already implemented in telegram.ts","dependencies":[{"issue_id":"deep_space_relay-69t","depends_on_id":"deep_space_relay-c9u","type":"parent-child","created_at":"2026-02-06T09:48:04.446370503+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-6l0","title":"Improve session event handling and add idle summary","status":"closed","priority":2,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-04T20:58:44.847073995+01:00","created_by":"apexsloth","updated_at":"2026-02-04T20:58:47.739237543+01:00","closed_at":"2026-02-04T20:58:47.739237543+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-6ms","title":"Implement subagent thread handling with emoji and silent creation","description":"This issue implements a strategy for handling subagent threads in Telegram to minimize noise.\n\nStrategy:\n1. **Visual Identification**:\n   - Idle: üí§\n   - Busy: üîß\n   - Disconnected: üëª\n   - Name Tag: [üßµ Subagent: Name] in thread titles.\n\n2. **Silent Creation**:\n   - Subagent threads are created without an initial 'Welcome' message.\n   - This prevents the thread from jumping to the top of the user's view or triggering a notification until the subagent actually sends a message or permission request.\n\n3. **Linking**:\n   - Broadcast links for subagents will use a thread icon (üßµ) and descriptive text to clarify it's a sub-task.\n\nImplementation details:\n- Update 'plugins/deep-space-relay/src/daemon.ts' to handle subagent-specific title formatting and track subagent status.\n- Update 'plugins/deep-space-relay/src/index.ts' to detect subagent sessions and suppress the welcome prompt.","notes":"Strategy approved by user. Implementation on hold until further instruction.","status":"closed","priority":2,"issue_type":"feature","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-04T21:35:04.214743478+01:00","created_by":"apexsloth","updated_at":"2026-02-04T23:43:59.205749546+01:00","closed_at":"2026-02-04T23:43:59.205749546+01:00","close_reason":"Implemented subagent thread handling with emoji tags and silent creation"}
{"id":"deep_space_relay-6rj","title":"Fix missing compaction and idle summaries","description":"The recently implemented noise reduction logic (Lazy Thread Creation) is preventing compaction and idle summaries from being sent even after a thread has been created. Need to investigate why 'hasThread' state is not correctly allowing these summaries or if the logic is too restrictive.","status":"closed","priority":1,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-05T00:07:26.669085894+01:00","created_by":"apexsloth","updated_at":"2026-02-05T00:13:07.634429131+01:00","closed_at":"2026-02-05T00:13:07.634429131+01:00","close_reason":"Fixed by setting hasThread=true when send/reply_to succeeds or thread message is received"}
{"id":"deep_space_relay-6xa","title":"Re-register with different chatId doesn't clear stale threadID","description":"When a session re-registers with a different chatId (handleRegister), the daemon updates session.chatId but does NOT clear session.threadID or update threadToSession mapping. This leaves a stale threadID pointing to the old chat. The next send will fail, triggering reactive recovery. The reconciler should fix this proactively by detecting chatId mismatch during reconcile().","status":"open","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-11T21:25:17.638490227+01:00","created_by":"apexsloth","updated_at":"2026-02-11T21:25:17.638490227+01:00"}
{"id":"deep_space_relay-72b","title":"Implement robust Two-Way Reactions (dsr_react_to + receiving notifications)","description":"Add a new DSR tool (e.g., dsr_react) that allows agents to react to messages in the Telegram thread using emojis (reactions). This should support standard Telegram reactions like üëç, üî•, üéâ, etc.","status":"closed","priority":3,"issue_type":"feature","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-04T21:40:53.09274213+01:00","created_by":"apexsloth","updated_at":"2026-02-05T00:06:56.424039426+01:00","closed_at":"2026-02-05T00:06:56.424039426+01:00","close_reason":"Implemented dsr_react_to tool and two-way reaction notifications"}
{"id":"deep_space_relay-7zp","title":"Race Conditions in Relay Core Correlation","description":"Using message types instead of unique IDs for request/response matching leads to state overwrites during concurrent operations.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-05T22:56:53.445339537+01:00","created_by":"apexsloth","updated_at":"2026-02-06T14:16:13.928962163+01:00","closed_at":"2026-02-06T14:16:13.928962163+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-82h","title":"Automatically register bot commands with Telegram","description":"The daemon should use the setMyCommands API to register available commands (like /start, /stop, /cleanup) so they appear in the Telegram command menu for better discovery.","status":"closed","priority":3,"issue_type":"feature","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-04T23:18:57.802541242+01:00","created_by":"apexsloth","updated_at":"2026-02-05T09:09:48.120442076+01:00","closed_at":"2026-02-05T09:09:48.120442076+01:00","close_reason":"Implemented automatic bot command registration. Commands /start, /stop, /cleanup, /list are now registered on daemon startup."}
{"id":"deep_space_relay-9ek","title":"Handle TCP ports in leader election logic","description":"checkLeaderAlive and forceLeaderTakeover use existsSync which fails for TCP port strings. Standardize to handle both sockets and ports.","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T09:43:56.048657768+01:00","created_by":"apexsloth","updated_at":"2026-02-06T11:34:05.428828886+01:00","closed_at":"2026-02-06T11:34:05.428828886+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-9up","title":"Daemon hot standby mode with socket takeover","description":"Implement hot standby mode for the daemon:\n\n1. On startup, check if the socket (/tmp/ds-relay.sock) is already in use\n2. If socket exists, perform an 'alive' check (send ping, expect pong)\n3. If alive, enter standby mode - wait and check once per minute\n4. If the primary daemon dies (alive check fails), take over:\n   - Remove stale socket file\n   - Bind to the socket\n   - Start handling requests\n\nBenefits:\n- Multiple daemon instances can run safely\n- Automatic failover if primary daemon crashes\n- Enables embedded daemon mode (see related issue)\n\nImplementation notes:\n- Add 'ping' message type to socket protocol\n- Daemon responds with 'pong' to prove it's alive\n- Standby daemon logs its status periodically","status":"closed","priority":2,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-05T09:43:34.100238718+01:00","created_by":"apexsloth","updated_at":"2026-02-05T22:36:52.960198673+01:00","closed_at":"2026-02-05T22:36:52.960198673+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-b1f","title":"Implement Framed and Authenticated IPC","description":"Use NDJSON for socket framing and implement token-based handshake for secure local communication.","design":"### Implementation Plan: Framed and Authenticated IPC\n\nGoal: Secure the local communication channel and prevent message fragmentation.\n\n#### 1. Message Framing\n- Replace raw string chunks with NDJSON (Newline Delimited JSON) or a length-prefixed protocol.\n- Use a buffer to handle partial data reads from the socket.\n\n#### 2. Authentication Handshake\n- When the plugin connects, it must send a `handshake` message containing a secret token (passed via environment variable).\n- The daemon rejects any connection that fails to authenticate within 1 second.","notes":"Implemented NDJSON framing and IPC token authentication. Verified with tests.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-06T09:47:59.870575025+01:00","created_by":"apexsloth","updated_at":"2026-02-06T11:57:03.561207491+01:00","closed_at":"2026-02-06T11:57:03.561207491+01:00","close_reason":"Implemented NDJSON framing and token authentication","dependencies":[{"issue_id":"deep_space_relay-b1f","depends_on_id":"deep_space_relay-c9u","type":"parent-child","created_at":"2026-02-06T09:48:04.354153364+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-b2v","title":"Thread title not synced on re-register","description":"When a session re-registers with a different title or project, handleRegister updates session.project and session.title in local state but never calls bot.editForumTopic to update the actual Telegram thread title. The thread keeps the stale title until the daemon restarts and recreates it.","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-08T00:18:13.747989948+01:00","created_by":"apexsloth","updated_at":"2026-02-08T16:30:36.186016901+01:00","closed_at":"2026-02-08T16:30:36.186016901+01:00","close_reason":"handleRegister now detects title/project changes on re-registration and calls bot.editForumTopic to sync the Telegram thread title."}
{"id":"deep_space_relay-b44","title":"IPC Security Vulnerability: Unauthenticated Unix Socket","description":"The Unix socket at /tmp/ds-relay.sock is unauthenticated, allowing any local user to hijack the bot or delete sessions.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-05T22:56:53.11805267+01:00","created_by":"apexsloth","updated_at":"2026-02-06T11:57:03.793939992+01:00","closed_at":"2026-02-06T11:57:03.793939992+01:00","close_reason":"Covered by b1f token authentication","dependencies":[{"issue_id":"deep_space_relay-b44","depends_on_id":"deep_space_relay-b1f","type":"blocks","created_at":"2026-02-06T09:48:15.512781601+01:00","created_by":"apexsloth"}],"comments":[{"id":7,"issue_id":"deep_space_relay-b44","author":"apexsloth","text":"Solution will be implemented in Authenticated IPC (b1f). Only verification is needed when that work is done.","created_at":"2026-02-06T08:48:20Z"}]}
{"id":"deep_space_relay-bdb","title":"Socket reconnection with exponential backoff","description":"Plugin has no reconnection logic. If daemon restarts, socket breaks and never reconnects. Fix: In index.ts socket.on('close'), if currentSessionID exists, schedule reconnection with exponential backoff (1s, 2s, 4s... up to 30s max). Reset attempts on successful connect.","status":"closed","priority":2,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-04T12:37:17.849471872+01:00","created_by":"apexsloth","updated_at":"2026-02-04T21:28:45.761752712+01:00","closed_at":"2026-02-04T21:28:45.761752712+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-blm","title":"BUG: Map mutation during iteration in cleanup command","description":"BUG: Map mutation during iteration in cleanup command skips entries\n\n## Bug Description\nIn src/daemon/commands.ts:197-206, the code deletes from state.sessions while iterating over it:\n\n```typescript\nfor (const [sid, session] of state.sessions.entries()) {\n  // ... cleanup logic ...\n  state.sessions.delete(sid);  // BUG: Modifying Map during iteration\n}\n```\n\n## Impact\nIn JavaScript, deleting from a Map while iterating can skip entries. Some stale sessions may never get cleaned up if they appear after a deleted entry in the iteration order.\n\n## Expected Behavior\nCollect all session IDs to delete first, then delete them in a separate loop.\n\n## Suggested Fix\n```typescript\nconst toDelete: string[] = [];\nfor (const [sid, session] of state.sessions.entries()) {\n  // ... check if should delete ...\n  toDelete.push(sid);\n}\nfor (const sid of toDelete) {\n  state.sessions.delete(sid);\n}\n```","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-11T18:09:51.703521271+01:00","created_by":"apexsloth","updated_at":"2026-02-11T18:10:53.451516597+01:00","closed_at":"2026-02-11T18:10:53.451516597+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-c0e","title":"Refactor: Move magic numbers to config/constants","description":"Hardcoded timeouts scattered throughout. Fix: Move to config or constants file. Locations: core.ts:6, lifecycle.ts:46, events.ts:6","status":"closed","priority":2,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-06T18:05:30.421885672+01:00","created_by":"apexsloth","updated_at":"2026-02-07T08:54:54.388396227+01:00","closed_at":"2026-02-07T08:54:54.388396227+01:00","close_reason":"Moved all magic numbers to src/constants.ts - 38 constants across 13 files"}
{"id":"deep_space_relay-c2u","title":"Verify multi-session concurrent registration stability","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-04T18:29:20.337413786+01:00","created_by":"apexsloth","updated_at":"2026-02-04T21:28:25.141240161+01:00","closed_at":"2026-02-04T21:28:25.141240161+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-c9u","title":"Prod Ready","description":"Architectural overhaul to move from a script-like router to a resilient, service-oriented daemon architecture.","status":"closed","priority":1,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-06T09:47:59.589235047+01:00","created_by":"apexsloth","updated_at":"2026-02-08T00:18:04.227566898+01:00","closed_at":"2026-02-08T00:18:04.227566898+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-c9u.1","title":"security: fix multi-user socket and PID file collision","description":"Current fixed paths in /tmp (/tmp/ds-relay.sock and /tmp/ds-relay.pid) allow for socket hijacking and token theft in multi-user environments. Move these to user-specific paths.","status":"closed","priority":1,"issue_type":"bug","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-06T21:18:10.908721094+01:00","created_by":"apexsloth","updated_at":"2026-02-06T21:21:38.914405622+01:00","closed_at":"2026-02-06T21:21:38.914405622+01:00","close_reason":"Implemented user-specific secure socket and PID paths using XDG_RUNTIME_DIR or secure local state dir.","dependencies":[{"issue_id":"deep_space_relay-c9u.1","depends_on_id":"deep_space_relay-c9u","type":"parent-child","created_at":"2026-02-06T21:18:10.91205633+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-c9u.2","title":"reliability: implement atomic state persistence","description":"Use atomic write strategy (write to .tmp then rename) for daemon state persistence to prevent data loss on crash.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-06T21:18:13.470977411+01:00","created_by":"apexsloth","updated_at":"2026-02-06T21:21:39.193652998+01:00","closed_at":"2026-02-06T21:21:39.193652998+01:00","close_reason":"Implemented atomic write strategy for state persistence.","dependencies":[{"issue_id":"deep_space_relay-c9u.2","depends_on_id":"deep_space_relay-c9u","type":"parent-child","created_at":"2026-02-06T21:18:13.471931566+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-c9u.3","title":"security: fix auth bypass with empty token","description":"Daemon allows connections without auth if ipcToken is empty or undefined. Ensure auth is required if a token is configured, and prevent starting without a token in production.","status":"closed","priority":1,"issue_type":"bug","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-06T21:18:16.389223847+01:00","created_by":"apexsloth","updated_at":"2026-02-06T21:21:39.05461789+01:00","closed_at":"2026-02-06T21:21:39.05461789+01:00","close_reason":"Ensured mandatory authentication with non-empty tokens in the daemon socket server.","dependencies":[{"issue_id":"deep_space_relay-c9u.3","depends_on_id":"deep_space_relay-c9u","type":"parent-child","created_at":"2026-02-06T21:18:16.390227445+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-co4","title":"Hide DSR debug tools behind environment variable flag","description":"Rename dsr_typing to dsr_debug_typing and conditionally expose all dsr_debug_* tools only when DSR_DEBUG_TOOLS=true environment variable is set.\n\nCurrent debug tools:\n- dsr_debug_register\n- dsr_debug_deregister  \n- dsr_debug_delete_session\n- dsr_debug_permission\n- dsr_typing (to be renamed to dsr_debug_typing)\n\nImplementation:\n- Add DSR_DEBUG_TOOLS env var check in createTools() in src/tools.ts\n- Only include debug tools in returned object when flag is enabled\n- Update any documentation/tests accordingly\n- Ensures production agents don't have access to debug-only tooling\n\nApproach:\nUse environment variable DSR_DEBUG_TOOLS=true to gate debug tool exposure. In createTools(), conditionally spread debug tools into the returned object based on process.env.DSR_DEBUG_TOOLS === 'true'.","status":"open","priority":3,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-10T19:54:51.110201989+01:00","created_by":"apexsloth","updated_at":"2026-02-10T19:54:51.110201989+01:00"}
{"id":"deep_space_relay-cww","title":"BUG: Messages sent to deleted threads end up in main channel","description":"When a Telegram thread is deleted manually, the daemon still has the old threadID in session state. When dsr_send is called, the message is sent with the stale threadID and ends up in the main channel instead of triggering thread recreation.\n\nRoot cause: handleSend in src/daemon/handlers.ts only checks if threadID exists, not if it's still valid. The recoverStaleThread function only runs AFTER the send fails.\n\nExpected behavior: Before sending, validate the thread exists (or catch the error properly) and recreate if needed.\n\nCurrent flow:\n1. Session has threadID=123 (deleted on Telegram)\n2. handleSend checks: threadID exists ‚Üí skip ensureThread\n3. Sends to threadID=123 ‚Üí message goes to main channel (or fails)\n4. recoverStaleThread called ‚Üí creates new thread\n5. Retry with new threadID\n\nThe first message is lost to the main channel.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-11T18:14:04.554818356+01:00","created_by":"apexsloth","updated_at":"2026-02-11T18:15:01.365785186+01:00","closed_at":"2026-02-11T18:15:01.365785186+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-eg0","title":"project.name is undefined in PluginContext","description":"The project object from PluginContext has name=undefined, causing thread titles to show 'OpenCode' instead of the actual project name.\n\nCurrent workaround: fallback to directory name. Root cause needs investigation - either OpenCode is not passing project info correctly, or the plugin context structure has changed.","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-05T09:33:41.105242593+01:00","created_by":"apexsloth","updated_at":"2026-02-05T09:43:24.822246917+01:00","closed_at":"2026-02-05T09:43:24.822246917+01:00","close_reason":"Fixed: Updated Project interface to match SDK, using project.id or worktree for project name"}
{"id":"deep_space_relay-ehe","title":"Security: Move socket from /tmp to user-specific path","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T17:58:28.300399525+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:15:25.432608262+01:00","closed_at":"2026-02-06T18:15:25.432608262+01:00","close_reason":"Moved socket to XDG_RUNTIME_DIR or ~/.local/state/opencode/"}
{"id":"deep_space_relay-gjt","title":"sessionID getting wrong value (model config instead of session ID)","description":"In the logs, sessionID is receiving incorrect values:\n- sessionID={\"options\":{\"thinkingConfig\":{\"includeThoughts\":true}}}\n- sessionID={\"topP\":0.95,\"topK\":64,\"options\":{...}}\n\nThe relay instance creation is receiving model configuration objects instead of actual session IDs. This breaks session tracking and message routing.","status":"closed","priority":1,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-05T09:33:41.097925852+01:00","created_by":"apexsloth","updated_at":"2026-02-05T09:43:23.744568429+01:00","closed_at":"2026-02-05T09:43:23.744568429+01:00","close_reason":"Fixed: Added typeof sessionID !== 'string' guard in chat.params hook"}
{"id":"deep_space_relay-hi1","title":"Make integration tests robust by clearing daemon state between tests","description":"Integration tests share daemon state (sessions, agent names) between tests, causing flaky failures from name collisions. Tests should clear daemon state in beforeEach to ensure isolation.\\n\\nCurrent workarounds:\\n- Random agent names (EVE-unique)\\n- Test-specific suffixes (TestBot-Title)\\n\\nBetter solution:\\n- Add daemon.clearSessions() or similar method\\n- Call in beforeEach after mockTelegram.reset()\\n\\nThis will prevent false failures from state bleeding between tests.","status":"open","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-12T18:22:39.245721302+01:00","created_by":"apexsloth","updated_at":"2026-02-12T18:22:39.245721302+01:00"}
{"id":"deep_space_relay-hky","title":"Daemon state persistence for restart recovery","description":"Daemon stores session-\u003ethread mappings only in memory. If daemon restarts, it loses all mappings and creates duplicate threads. Fix: Persist sessions and threadToSession Maps to JSON file (e.g., /tmp/ds-relay-state.json), load on startup, save after changes.","status":"closed","priority":2,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-04T12:37:15.37217808+01:00","created_by":"apexsloth","updated_at":"2026-02-04T18:29:23.965861192+01:00","closed_at":"2026-02-04T18:29:23.965863957+01:00"}
{"id":"deep_space_relay-hnt","title":"Implement Message ID Tracking and dsr_reply_to tool","description":"Current reaction system only tracks last message. Improve to:\n1. Track message IDs for all sent messages\n2. Add reactTo(messageId, emoji) tool\n3. Add replyTo(messageId, text) tool\n4. Suppress Telegram 'title changed' announcements if possible","status":"closed","priority":2,"issue_type":"feature","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-04T22:24:51.2649936+01:00","created_by":"apexsloth","updated_at":"2026-02-04T23:48:27.9044377+01:00","closed_at":"2026-02-04T23:48:27.9044377+01:00","close_reason":"Implemented message ID tracking and dsr_reply_to tool. All 22 integration tests pass."}
{"id":"deep_space_relay-i61","title":"Memory leak: sessions never cleaned up","description":"When a client disconnects, only 'clients' Map is cleaned. The 'sessions' and 'threadToSession' Maps grow unbounded causing OOM. Fix: In daemon.ts socket.on('close') handler, also delete from sessions and threadToSession Maps.","status":"closed","priority":1,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-04T12:37:09.867424332+01:00","created_by":"apexsloth","updated_at":"2026-02-04T12:45:45.97173887+01:00","closed_at":"2026-02-04T12:45:45.97173887+01:00","close_reason":"Added cleanup for sessions and threadToSession Maps on disconnect"}
{"id":"deep_space_relay-ick","title":"Resolve race condition in bot username fetching","description":"The bot username is fetched asynchronously and might not be available when the first messages arrive, causing command parsing issues.","status":"closed","priority":3,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T09:43:56.330861465+01:00","created_by":"apexsloth","updated_at":"2026-02-07T09:06:27.640133623+01:00","closed_at":"2026-02-07T09:06:27.640133623+01:00","close_reason":"Closed per user request"}
{"id":"deep_space_relay-ivh","title":"Auto-connect to daemon on OpenCode startup","description":"Currently the DSR plugin only connects to the daemon on the first user message. It would be better to auto-connect immediately when OpenCode starts, so the session is ready before any user interaction.","status":"closed","priority":3,"issue_type":"feature","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-05T11:01:28.077706456+01:00","created_by":"apexsloth","updated_at":"2026-02-08T16:23:20.410933035+01:00","closed_at":"2026-02-08T16:23:20.410933035+01:00","close_reason":"Implemented auto-connect on plugin init. Plugin now calls client.session.list() at startup and registers all existing top-level sessions with the daemon, enabling Telegram-to-agent messaging for resumed sessions without waiting for the agent to speak first."}
{"id":"deep_space_relay-j9z","title":"Risk of State Corruption during Persistence","description":"The Daemon uses blocking writeFileSync for state management on nearly every event. This blocks the event loop, causing latency in message processing and potentially triggering leadership flapping. Additionally, it lacks atomicity, risking file truncation/corruption during crashes.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-05T22:56:53.2812365+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:18:19.28254439+01:00","closed_at":"2026-02-06T18:18:19.28254439+01:00","close_reason":"Covered by n5o - atomic writes for state.json","dependencies":[{"issue_id":"deep_space_relay-j9z","depends_on_id":"deep_space_relay-69t","type":"blocks","created_at":"2026-02-06T09:48:15.604769354+01:00","created_by":"apexsloth"}],"comments":[{"id":8,"issue_id":"deep_space_relay-j9z","author":"apexsloth","text":"Solution will be implemented in Atomic Persistence (69t). Only verification is needed when that work is done.","created_at":"2026-02-06T08:48:20Z"}]}
{"id":"deep_space_relay-jes","title":"Enhancement: Auto-cleanup old disconnected sessions","description":"Sessions only removed via /cleanup. Fix: Auto-cleanup sessions disconnected for X days. Location: state.ts, handlers.ts","status":"closed","priority":2,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-06T18:05:12.404939869+01:00","created_by":"apexsloth","updated_at":"2026-02-07T08:58:06.303392174+01:00","closed_at":"2026-02-07T08:58:06.303392174+01:00","close_reason":"Implemented auto-cleanup on startup for sessions disconnected \u003e7 days"}
{"id":"deep_space_relay-jpl","title":"Bug: Add exponential backoff for polling errors","description":"Polling uses fixed 5s delay on error. Fix: Add exponential backoff or circuit breaker. Location: runner.ts:211-232","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T18:04:16.992218069+01:00","created_by":"apexsloth","updated_at":"2026-02-07T09:02:20.320531517+01:00","closed_at":"2026-02-07T09:02:20.320531517+01:00","close_reason":"Added exponential backoff for polling errors (1s-\u003e2s-\u003e4s-\u003e8s-\u003e16s-\u003e32s-\u003e60s max)"}
{"id":"deep_space_relay-mmm","title":"dsr_react and dsr_react_to tools not working","description":"The dsr_react and dsr_react_to tools complete in 0ms without actually sending reactions to Telegram. Logs show:\n- status=started dsr_react\n- status=completed duration=0 dsr_react\n\nThe tools are being registered but not executing properly. Need to debug the tool handler in index.ts.","status":"closed","priority":1,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-05T09:33:34.494949334+01:00","created_by":"apexsloth","updated_at":"2026-02-05T09:43:22.823140651+01:00","closed_at":"2026-02-05T09:43:22.823140651+01:00","close_reason":"Fixed: Added typeof sessionId !== 'string' check to dsr_react and dsr_react_to tools"}
{"id":"deep_space_relay-n5o","title":"Bug: Use atomic writes for state.json","description":"writeFileSync can corrupt state on crash. Fix: Write to .tmp then rename. Location: state.ts:48-63","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T17:58:39.679786174+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:07:14.548513086+01:00","closed_at":"2026-02-06T18:07:14.548513086+01:00","close_reason":"Implemented atomic writes with .tmp file and rename"}
{"id":"deep_space_relay-o1a","title":"BUG: Thread messages lack feedback when forwarded to agents","description":"BUG: Thread messages lack feedback when forwarded to agents\n\n## Bug Description\nIn src/daemon/commands.ts:561-644, messages in threads are forwarded to agents without any reaction or acknowledgment. If the agent is slow or disconnected, the message appears to vanish from the user's perspective.\n\n## Impact\nUsers send messages in threads and see no response. They don't know if:\n1. The message was received\n2. The agent is processing\n3. The agent is offline\n\n## Expected Behavior\nAdd a reaction (e.g., üëÄ or ‚è≥) when a message is received and being forwarded to the agent. This provides immediate visual feedback.\n\n## Current Code\nsrc/daemon/commands.ts:561-644:\n```typescript\n// Forward the message to the connected agent\nif (client?.send) {\n  client.send({\n    type: 'command',\n    sessionId: session.id,\n    text: fullText,\n  });\n} else {\n  // ...\n}\n```\n\n## Suggested Fix\nAdd a setMessageReaction call before forwarding to acknowledge receipt.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-11T18:09:52.836923857+01:00","created_by":"apexsloth","updated_at":"2026-02-11T18:10:53.647341299+01:00","closed_at":"2026-02-11T18:10:53.647341299+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-o7k","title":"Add bot command /cleanstale to remove orphaned threads","description":"Add /cleanstale bot command that:\n- Lists all threads in the Telegram group\n- Identifies threads with no active session connection\n- Provides option to delete stale threads\n- Shows age and last activity of each thread","status":"closed","priority":3,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-04T17:32:56.728134797+01:00","created_by":"apexsloth","updated_at":"2026-02-04T21:27:35.201781744+01:00","closed_at":"2026-02-04T21:27:35.201781744+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-oku","title":"Persist daemon state to .opencode instead of /tmp","description":"Currently daemon state is stored in /tmp/ds-relay-state.json which does not survive reboot. Move to persistent location like .opencode/ds-relay-state.json in the project directory.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-04T13:34:45.196626259+01:00","created_by":"apexsloth","updated_at":"2026-02-04T18:29:23.934025665+01:00","closed_at":"2026-02-04T18:29:23.934034412+01:00"}
{"id":"deep_space_relay-p5r","title":"Improve daemon shutdown and resource cleanup","description":"The hardcoded 500ms shutdown timeout in worker.ts is unreliable. Implement a more robust graceful shutdown that ensures socket unlinking and state saving.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-06T09:43:56.237128217+01:00","created_by":"apexsloth","updated_at":"2026-02-06T11:34:41.587282685+01:00","closed_at":"2026-02-06T11:34:41.587282685+01:00","close_reason":"Verified: LifecycleCoordinator centralizes and ensures socket unlinking.","dependencies":[{"issue_id":"deep_space_relay-p5r","depends_on_id":"deep_space_relay-y2z","type":"blocks","created_at":"2026-02-06T09:48:15.323380988+01:00","created_by":"apexsloth"}],"comments":[{"id":5,"issue_id":"deep_space_relay-p5r","author":"apexsloth","text":"Solution will be implemented in LifecycleCoordinator (y2z). Only verification is needed when that work is done.","created_at":"2026-02-06T08:48:19Z"}]}
{"id":"deep_space_relay-pjb","title":"Support multi-chat mapping for projects and worktrees","description":"Enhance the daemon and plugin to support multiple Telegram chats. Features:\n1. Routing: Map sessions to specific Chat IDs based on project path or root directory.\n2. Multi-Group Support: Allow the bot to be active in multiple Telegram groups simultaneously.\n3. Configuration: Update config.json to store a map of path patterns to Chat IDs.\n4. Worktree/Clone isolation: Keep communications for different clones or projects in separate Telegram chats to avoid clutter.","status":"closed","priority":3,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-04T23:36:24.037197189+01:00","created_by":"apexsloth","updated_at":"2026-02-07T09:06:27.825238691+01:00","closed_at":"2026-02-07T09:06:27.825238691+01:00","close_reason":"Closed per user request"}
{"id":"deep_space_relay-r3k","title":"Implement /list command to show all agents and their threads","description":"Add a /list command to the Telegram bot that:\n1. Iterates through all active sessions.\n2. Lists each agent with their status (ü§ñ/üîß), name, and session title.\n3. Provides a üîó deep link to the thread if it exists.\n4. For agents without a thread (lazy creation), list them as 'Silent' or 'Pending' with no link.","status":"closed","priority":3,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-04T23:31:00.555177199+01:00","created_by":"apexsloth","updated_at":"2026-02-06T14:03:19.72939362+01:00","closed_at":"2026-02-06T14:03:19.72939362+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-ryt","title":"Idle message sent to General when threadID undefined","description":"session.idle event fires before registration response arrives, so currentThreadID is undefined. The idle message is sent without message_thread_id, landing in General channel. Fix: In session.idle handler, skip sending if currentThreadID is undefined OR wait for registration to complete before sending idle messages.","status":"closed","priority":1,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-04T12:37:22.64292764+01:00","created_by":"apexsloth","updated_at":"2026-02-04T12:39:00.599203478+01:00","closed_at":"2026-02-04T12:39:00.599203478+01:00","close_reason":"Fixed idle message guard to prevent sending to General - added logging to debug threadID state"}
{"id":"deep_space_relay-scr","title":"Security: Remove token from debug logs","description":"Debug logs expose 8 chars of bot token at server.ts:64. Fix: Only log auth success/failure boolean.","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T17:58:34.986901726+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:12:12.082932209+01:00","closed_at":"2026-02-06T18:12:12.082932209+01:00","close_reason":"Removed token values from debug logs, only log success boolean"}
{"id":"deep_space_relay-slm","title":"NPX-runnable CLI with setup command","description":"Make DSR runnable via npx with proper CLI subcommands (setup, start, status, stop). Default embedded daemon to false so plugin connects to external daemon.","status":"closed","priority":1,"issue_type":"epic","owner":"code@apexsloth.com","created_at":"2026-02-06T17:38:49.656298397+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:04:31.123934017+01:00","closed_at":"2026-02-06T18:04:31.123934017+01:00","close_reason":"Epic complete: NPX-runnable CLI with setup/start/status/stop commands"}
{"id":"deep_space_relay-slm.1","title":"Refactor setup.ts to export functions","description":"Export setup logic as reusable functions that can be called from CLI. Keep standalone execution for backward compat.","status":"closed","priority":1,"issue_type":"task","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-06T17:39:26.234169874+01:00","created_by":"apexsloth","updated_at":"2026-02-06T17:51:02.977307061+01:00","closed_at":"2026-02-06T17:51:02.977307061+01:00","close_reason":"Refactored setup.ts: exported functions, types, constants; replaced process.exit with UserCancelledError; added SetupOptions","dependencies":[{"issue_id":"deep_space_relay-slm.1","depends_on_id":"deep_space_relay-slm","type":"parent-child","created_at":"2026-02-06T17:39:26.235621064+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-slm.2","title":"Rewrite cli.ts as proper CLI","description":"Replace test CLI with proper subcommand CLI using zero-deps arg parsing. Commands: setup, start, status, stop. Add shebang.","status":"closed","priority":1,"issue_type":"task","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-06T17:39:31.059691146+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:00:19.358303524+01:00","closed_at":"2026-02-06T18:00:19.358303524+01:00","close_reason":"Rewrote cli.ts with proper subcommands (setup/start/status/stop/help), IPC auth, config checks, statePath","dependencies":[{"issue_id":"deep_space_relay-slm.2","depends_on_id":"deep_space_relay-slm","type":"parent-child","created_at":"2026-02-06T17:39:31.060616377+01:00","created_by":"apexsloth"},{"issue_id":"deep_space_relay-slm.2","depends_on_id":"deep_space_relay-slm.1","type":"blocks","created_at":"2026-02-06T17:39:43.37236657+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-slm.3","title":"Add bin entry to package.json","description":"Add bin field pointing to dist/cli.js. Names: deep-space-relay and dsr (alias).","status":"closed","priority":1,"issue_type":"task","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-06T17:39:32.690975761+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:02:53.227591958+01:00","closed_at":"2026-02-06T18:02:53.227591958+01:00","close_reason":"Added bin entry for deep-space-relay and dsr","dependencies":[{"issue_id":"deep_space_relay-slm.3","depends_on_id":"deep_space_relay-slm","type":"parent-child","created_at":"2026-02-06T17:39:32.691898617+01:00","created_by":"apexsloth"},{"issue_id":"deep_space_relay-slm.3","depends_on_id":"deep_space_relay-slm.2","type":"blocks","created_at":"2026-02-06T17:39:43.464557012+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-slm.4","title":"Add config check to runner.ts","description":"Before starting daemon, check if token.json exists. If missing, show helpful error with dsr setup command.","status":"closed","priority":1,"issue_type":"task","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-06T17:39:34.425082752+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:02:53.331569846+01:00","closed_at":"2026-02-06T18:02:53.331569846+01:00","close_reason":"Added config check in runDaemon with helpful error message","dependencies":[{"issue_id":"deep_space_relay-slm.4","depends_on_id":"deep_space_relay-slm","type":"parent-child","created_at":"2026-02-06T17:39:34.426022791+01:00","created_by":"apexsloth"},{"issue_id":"deep_space_relay-slm.4","depends_on_id":"deep_space_relay-slm.2","type":"blocks","created_at":"2026-02-06T17:39:43.561015574+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-slm.5","title":"Default embeddedDaemon to false","description":"Change plugin default so it connects to external daemon instead of spawning worker. Users run dsr start separately.","status":"closed","priority":1,"issue_type":"task","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-06T17:39:36.063682908+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:02:53.428835727+01:00","closed_at":"2026-02-06T18:02:53.428835727+01:00","close_reason":"Changed embedded default from true to false","dependencies":[{"issue_id":"deep_space_relay-slm.5","depends_on_id":"deep_space_relay-slm","type":"parent-child","created_at":"2026-02-06T17:39:36.064676427+01:00","created_by":"apexsloth"},{"issue_id":"deep_space_relay-slm.5","depends_on_id":"deep_space_relay-slm.2","type":"blocks","created_at":"2026-02-06T17:39:43.655815069+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-slm.6","title":"Update build to output executable CLI","description":"Ensure bun build outputs dist/cli.js with proper shebang and executable permissions for npx.","status":"closed","priority":1,"issue_type":"task","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-06T17:39:37.544640554+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:03:58.050873804+01:00","closed_at":"2026-02-06T18:03:58.050873804+01:00","close_reason":"Build now outputs executable dist/cli.js with shebang","dependencies":[{"issue_id":"deep_space_relay-slm.6","depends_on_id":"deep_space_relay-slm","type":"parent-child","created_at":"2026-02-06T17:39:37.545950461+01:00","created_by":"apexsloth"},{"issue_id":"deep_space_relay-slm.6","depends_on_id":"deep_space_relay-slm.3","type":"blocks","created_at":"2026-02-06T17:39:43.750351436+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-slm.7","title":"Test npx execution","description":"Verify npx deep-space-relay setup and npx dsr start work correctly.","status":"closed","priority":2,"issue_type":"task","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-06T17:39:38.925764384+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:04:29.528157543+01:00","closed_at":"2026-02-06T18:04:29.528157543+01:00","close_reason":"Tested: ./dist/cli.js, npm link, dsr help, deep-space-relay help all work","dependencies":[{"issue_id":"deep_space_relay-slm.7","depends_on_id":"deep_space_relay-slm","type":"parent-child","created_at":"2026-02-06T17:39:38.926726914+01:00","created_by":"apexsloth"},{"issue_id":"deep_space_relay-slm.7","depends_on_id":"deep_space_relay-slm.6","type":"blocks","created_at":"2026-02-06T17:39:43.844630833+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-vev","title":"Socket Message Framing Issues","description":"Lack of buffering for incomplete packets causes JSON parsing failures for large payloads (logs, summaries).","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-05T22:56:53.364674914+01:00","created_by":"apexsloth","updated_at":"2026-02-06T11:57:03.682763049+01:00","closed_at":"2026-02-06T11:57:03.682763049+01:00","close_reason":"Covered by b1f NDJSON implementation","dependencies":[{"issue_id":"deep_space_relay-vev","depends_on_id":"deep_space_relay-b1f","type":"blocks","created_at":"2026-02-06T09:48:15.41521286+01:00","created_by":"apexsloth"}],"comments":[{"id":6,"issue_id":"deep_space_relay-vev","author":"apexsloth","text":"Solution will be implemented in Framed IPC (b1f). Only verification is needed when that work is done.","created_at":"2026-02-06T08:48:19Z"}]}
{"id":"deep_space_relay-vka","title":"Bug: Cap messageIDs array to prevent memory leak","description":"session.messageIDs grows forever. Fix: Cap at 100 entries or track first/last ID. Location: handlers.ts:228","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T17:58:38.127601139+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:08:57.095970456+01:00","closed_at":"2026-02-06T18:08:57.095970456+01:00","close_reason":"Added cap of 100 entries to messageIDs array with addMessageID helper"}
{"id":"deep_space_relay-wla","title":"Broadcast fallback inconsistency with agent name prefix","description":"handleSend drops the agent name prefix entirely when no agentName is set (good for threads). handleBroadcast falls back to '**[Agent]:**' when no name is set. These should be consistent ‚Äî broadcasts should probably also drop the prefix when no name is set, or use a better default.","status":"closed","priority":3,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-08T00:18:17.048984287+01:00","created_by":"apexsloth","updated_at":"2026-02-08T16:30:36.27668808+01:00","closed_at":"2026-02-08T16:30:36.27668808+01:00","close_reason":"handleBroadcast no longer falls back to hardcoded '[Agent]:' prefix. When no agentName is set, it drops the prefix entirely, consistent with handleSend."}
{"id":"deep_space_relay-wy4","title":"Restore agent name prefix in thread titles","description":"The agent name (username) prefix in Telegram thread titles (e.g., ü§ñ [Wall-E] Project: Title) was lost during recent refactoring. Need to restore this branding while maintaining the new emoji logic (ü§ñ for main, üîß for subagents).","status":"closed","priority":2,"issue_type":"bug","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-04T23:30:19.620441604+01:00","created_by":"apexsloth","updated_at":"2026-02-04T23:43:59.233887647+01:00","closed_at":"2026-02-04T23:43:59.233887647+01:00","close_reason":"Restored agent name prefix in thread titles with [ü§ñ Name] format"}
{"id":"deep_space_relay-xf6","title":"Implement ConfigManager for atomic config operations","description":"Centralize configuration management to handle atomic read-modify-write operations. Prevents data loss and state corruption.","design":"### Implementation Plan: ConfigManager\n\nGoal: Prevent configuration data loss by moving from direct `writeFileSync` to an atomic, transactional configuration service.\n\n#### 1. Atomic Operations\n- Implement a Load-Merge-Save pattern.\n- Use atomic file writes: Write to `${path}.tmp` then rename to `${path}`.\n\n#### 2. Service Interface\n- `get(key)`: Typed access to config.\n- `set(key, value)` / `update(partial)`: Automatically persists changes.\n- `on('change', ...)`: Allow other services (like the bot) to react to config updates.\n\n#### 3. Integration\n- Refactor `/start` handler to use `configManager.update({ chatId })`.\n- Ensure token and other settings are preserved during updates.","status":"closed","priority":1,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-06T09:47:59.682376722+01:00","created_by":"apexsloth","updated_at":"2026-02-06T11:35:34.944976559+01:00","closed_at":"2026-02-06T11:35:34.944976559+01:00","close_reason":"Implemented ConfigManager with atomic Load-Merge-Save pattern and verified with tests.","dependencies":[{"issue_id":"deep_space_relay-xf6","depends_on_id":"deep_space_relay-c9u","type":"parent-child","created_at":"2026-02-06T09:48:04.170994737+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-y2z","title":"Implement LifecycleCoordinator state machine","description":"Formal state machine for Leader Election, Standby, and Shutdown transitions. Handles EADDRINUSE and race conditions gracefully.","design":"### Implementation Plan: LifecycleCoordinator\n\nGoal: Move leader election and socket management into a formal state machine to prevent race conditions and improve reliability.\n\n#### 1. Core State Machine\nDefine a `LifecycleState` union: `'initializing' | 'standby' | 'leading' | 'shutting_down'`.\n\n#### 2. Service Responsibilities\n- **Election:** Periodically ping the existing socket. If no response, attempt takeover.\n- **Takeover:** Handle `EADDRINUSE` during `server.listen()`. If bind fails, transition back to `standby` instead of crashing.\n- **Heartbeat:** As leader, respond to pings. As standby, verify leader health.\n- **Cleanup:** Unlink Unix socket on SIGTERM/SIGINT/AbortSignal.\n\n#### 3. Refactoring\n- Extract logic from `runner.ts` into a new `LifecycleCoordinator` class.\n- Update `worker.ts` to delegate lifecycle control to the coordinator.","status":"closed","priority":1,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-06T09:47:59.778205732+01:00","created_by":"apexsloth","updated_at":"2026-02-06T11:34:41.408937539+01:00","closed_at":"2026-02-06T11:34:41.408937539+01:00","close_reason":"Refined state machine implemented and verified with takeover tests.","dependencies":[{"issue_id":"deep_space_relay-y2z","depends_on_id":"deep_space_relay-c9u","type":"parent-child","created_at":"2026-02-06T09:48:04.26363709+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-y34","title":"BUG: Wrong variable used in /stop command reaction","description":"BUG: Wrong variable used in /stop command reaction (chatId vs msgChatId)\n\n## Bug Description\nIn src/daemon/commands.ts:183, the code uses chatId (from getChatId()) instead of msgChatId (from msg.chat.id):\n\n```typescript\nchat_id: chatId,  // Uses getChatId() instead of msgChatId\n```\n\n## Impact\nIf chatId differs from msgChatId, the thumbs up reaction is sent to the wrong chat. This could happen if getChatId() returns a default or different chat ID.\n\n## Expected Behavior\nThe reaction should be sent to the chat where the message was received (msgChatId).\n\n## Current Code\nsrc/daemon/commands.ts:181-186:\n```typescript\nawait telegram.setMessageReaction({\n  chat_id: chatId,\n  message_id: msg.message_id,\n  reaction: [{ type: 'emoji', emoji: 'üëç' }],\n});\n```\n\n## Suggested Fix\nUse msgChatId instead of chatId.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-11T18:09:52.306063405+01:00","created_by":"apexsloth","updated_at":"2026-02-11T18:10:53.548572044+01:00","closed_at":"2026-02-11T18:10:53.548572044+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-ydg","title":"Two-way Ground Control Relay","description":"Enable real-time two-way communication between agent and Ground Control (Telegram). Agent can send notifications and receive messages that get injected into context.","status":"closed","priority":1,"issue_type":"epic","owner":"code@apexsloth.com","created_at":"2026-02-04T10:34:02.533180503+01:00","created_by":"apexsloth","updated_at":"2026-02-04T21:28:39.577596041+01:00","closed_at":"2026-02-04T21:28:39.577596041+01:00","close_reason":"Closed"}
{"id":"deep_space_relay-ydg.1","title":"Config options for polling","description":"Add configuration options: polling interval, enable/disable polling, debounce settings. Support via plugin config or env vars.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-04T10:34:07.367445904+01:00","created_by":"apexsloth","updated_at":"2026-02-04T21:28:39.604818477+01:00","closed_at":"2026-02-04T21:28:39.604818477+01:00","close_reason":"Closed","dependencies":[{"issue_id":"deep_space_relay-ydg.1","depends_on_id":"deep_space_relay-ydg","type":"parent-child","created_at":"2026-02-04T10:34:07.368893814+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-ydg.2","title":"Research push vs poll for message injection","description":"Investigate ctx.client.session.prompt() from oh-my-opencode. Determine: can we poll in background interval? Can we use webhooks? What triggers agent wakeup?","status":"closed","priority":1,"issue_type":"task","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-04T10:34:09.497208659+01:00","created_by":"apexsloth","updated_at":"2026-02-04T10:35:57.097729218+01:00","closed_at":"2026-02-04T10:35:57.097729218+01:00","close_reason":"Closed","dependencies":[{"issue_id":"deep_space_relay-ydg.2","depends_on_id":"deep_space_relay-ydg","type":"parent-child","created_at":"2026-02-04T10:34:09.498578233+01:00","created_by":"apexsloth"}],"comments":[{"id":1,"issue_id":"deep_space_relay-ydg.2","author":"apexsloth","text":"## Research Findings\n\n### ctx.client.session.prompt() API\n```typescript\nawait ctx.client.session.prompt({\n  path: { id: sessionID },\n  body: { parts: [{ type: 'text', text: message }] },\n  query: { directory: ctx.directory },\n});\n```\n\n### Required Components\n1. **Session tracking** - Need to track main session ID via session.created event\n2. **Event-driven** - Best trigger point is session.idle event\n3. **Stop guard** - Should respect user stop commands\n\n### Implementation Plan\n1. Store ctx (with client) at plugin init\n2. Track mainSessionID on session.created (skip if has parentID = subagent)\n3. On session.idle, check Telegram for messages\n4. If messages exist, call ctx.client.session.prompt() to inject\n5. Add config for enable/disable polling\n\n### Push vs Poll\n- **Poll**: Use session.idle event as trigger (not interval)\n- **Push**: Could use setInterval but risks interrupting agent mid-work\n- **Recommendation**: Event-driven (session.idle) is safer","created_at":"2026-02-04T09:35:52Z"}]}
{"id":"deep_space_relay-ydg.3","title":"Implement direct message injection","description":"Use ctx.client.session.prompt() to inject Telegram messages directly into session without waiting for user input. Agent should wake up when Ground Control sends a message.","status":"closed","priority":1,"issue_type":"task","assignee":"apexsloth","owner":"code@apexsloth.com","created_at":"2026-02-04T10:34:10.833709723+01:00","created_by":"apexsloth","updated_at":"2026-02-04T10:58:03.729081869+01:00","closed_at":"2026-02-04T10:58:03.729081869+01:00","close_reason":"Closed","dependencies":[{"issue_id":"deep_space_relay-ydg.3","depends_on_id":"deep_space_relay-ydg","type":"parent-child","created_at":"2026-02-04T10:34:10.835402829+01:00","created_by":"apexsloth"},{"issue_id":"deep_space_relay-ydg.3","depends_on_id":"deep_space_relay-ydg.2","type":"blocks","created_at":"2026-02-04T10:34:14.985967983+01:00","created_by":"apexsloth"}],"comments":[{"id":2,"issue_id":"deep_space_relay-ydg.3","author":"apexsloth","text":"Implemented background polling with session.prompt() injection. Session ID captured from transform hook as fallback for restored sessions.","created_at":"2026-02-04T09:58:03Z"}]}
{"id":"deep_space_relay-ydg.4","title":"Implement Telegram Forum Topics per session","description":"Use createForumTopic to create a thread per session. Route notifications and polls to the specific thread_id. Store mapping in .opencode/relay-threads.json for persistence.","status":"closed","priority":2,"issue_type":"task","owner":"code@apexsloth.com","created_at":"2026-02-04T11:00:43.28436325+01:00","created_by":"apexsloth","updated_at":"2026-02-04T11:58:02.450081813+01:00","closed_at":"2026-02-04T11:58:02.450081813+01:00","close_reason":"Implemented Forum Topics per session with UDS daemon, specific routing, and broadcast logic. Verified direct/broadcast labels and idle message cleanup.","dependencies":[{"issue_id":"deep_space_relay-ydg.4","depends_on_id":"deep_space_relay-ydg","type":"parent-child","created_at":"2026-02-04T11:00:43.286311168+01:00","created_by":"apexsloth"}]}
{"id":"deep_space_relay-yxo","title":"Reactions not working","description":"dsr_react and dsr_react_to tools fail silently. The reaction doesn't appear in Telegram.\n\nhandleReact in handlers.ts:183 returns early if no session.threadID. This may be the issue when reacting to broadcast messages (which aren't in a thread).\n\nInvestigate:\n- Whether messageID from broadcast is being tracked\n- Whether chatId is correct for main channel vs thread\n- Whether bot has permission to react in the channel","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T16:51:27.596876023+01:00","created_by":"apexsloth","updated_at":"2026-02-06T18:02:18.869940344+01:00","closed_at":"2026-02-06T18:02:18.869940344+01:00","close_reason":"Reactions are now working correctly"}
{"id":"deep_space_relay-yxy","title":"Fix configuration overwrite bug in /start command","description":"In commands.ts, the /start command uses writeFileSync which overwrites the entire config. It should load, merge, and save instead.","status":"closed","priority":1,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T09:43:55.861233101+01:00","created_by":"apexsloth","updated_at":"2026-02-06T11:35:35.055577252+01:00","closed_at":"2026-02-06T11:35:35.055577252+01:00","close_reason":"Verified: ConfigManager preserves existing settings during /start command.","dependencies":[{"issue_id":"deep_space_relay-yxy","depends_on_id":"deep_space_relay-xf6","type":"blocks","created_at":"2026-02-06T09:48:15.138379336+01:00","created_by":"apexsloth"}],"comments":[{"id":3,"issue_id":"deep_space_relay-yxy","author":"apexsloth","text":"Solution will be implemented in ConfigManager (xf6). Only verification is needed when that work is done.","created_at":"2026-02-06T08:48:19Z"}]}
{"id":"deep_space_relay-zd4","title":"Bug: PID file not cleaned on crash","description":"Crashed daemon leaves stale PID file. Fix: Add stale PID detection or cleanup on startup. Location: runner.ts:199-204","status":"closed","priority":2,"issue_type":"bug","owner":"code@apexsloth.com","created_at":"2026-02-06T18:13:49.756679029+01:00","created_by":"apexsloth","updated_at":"2026-02-06T21:21:53.673115572+01:00","closed_at":"2026-02-06T21:21:53.673115572+01:00","close_reason":"Added uncaughtException and unhandledRejection handlers to ensure the PID file is cleaned up even on crashes."}
{"id":"deep_space_relay-zq5","title":"Embedded daemon mode (run daemon inside OpenCode plugin)","description":"Allow the daemon to run embedded inside the OpenCode plugin process instead of requiring a separate daemon process.\n\n1. Add config option: `embedded: boolean` (default: false)\n2. When embedded=true:\n   - Plugin spawns daemon logic in same process on initialization\n   - Uses hot standby mode to handle multiple OpenCode sessions gracefully\n   - First session becomes primary daemon, others go to standby\n   - When primary session exits, standby takes over\n\n3. Config example in opencode.json:\n   ```json\n   {\n     \"plugins\": {\n       \"deep-space-relay\": {\n         \"embedded\": true\n       }\n     }\n   }\n   ```\n\nBenefits:\n- No need to run separate daemon in Zellij/tmux\n- Simpler setup for users\n- Still supports external daemon for advanced users\n\nDependencies:\n- Requires hot standby mode (deep_space_relay-XXX) to be implemented first","status":"closed","priority":2,"issue_type":"feature","owner":"code@apexsloth.com","created_at":"2026-02-05T09:43:39.651605744+01:00","created_by":"apexsloth","updated_at":"2026-02-05T22:36:05.146826179+01:00","closed_at":"2026-02-05T22:36:05.146826179+01:00","close_reason":"Closed"}
